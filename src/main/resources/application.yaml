spring:
  application:
    name: library-api

  datasource:
    url: jdbc:postgresql://${POSTGRES_SERVER:localhost}:${POSTGRES_PORT:5432}/${POSTGRES_DB:libraryapispringboot}
    username: ${POSTGRES_USER:admin}
    password: ${POSTGRES_PASSWORD:aaAA1234}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 15
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  web:
    error:
      include-message: always
      include-binding-errors: always
      include-stacktrace: never
      include-exception: false

  jpa:
    hibernate:
      ddl-auto: ${DDL_AUTO:update}

# Management Endpoints (Actuator)
management:
  endpoints:
    web:
      exposure:
        include: health
      base-path: /
  endpoint:
    health:
      show-details: never

# Server Configuration
server:
  port: ${PORT:8080}

# Logging
logging:
  level:
    root: INFO
    com.library.api: ${LOG_LEVEL:INFO}
    org.springframework.web: INFO
    org.hibernate: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"

# Swagger/OpenAPI Configuration
springdoc:
  api-docs:
    path: /v3/api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    tags-sorter: alpha
    operations-sorter: alpha
    try-it-out-enabled: true
    filter: true
  show-actuator: false

# Application Security Configuration
application:
  security:
    jwt:
      secret-key: ${JWT_SECRET_KEY:404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970}
      expiration: ${JWT_EXPIRATION:3600000} # 1 hour in milliseconds
      issuer: ${JWT_ISSUER:library-api}
      audience: ${JWT_AUDIENCE:library-api-client}
    
    cors:
      allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:5173}
      allowed-methods: GET,POST,PUT,DELETE,PATCH,OPTIONS
      allowed-headers: "*"
      allow-credentials: true
      max-age: 3600
    
    rate-limit:
      auth-endpoints:
        capacity: 5
        refill-tokens: 5
        refill-duration-minutes: 1
      general-endpoints:
        capacity: 100
        refill-tokens: 100
        refill-duration-minutes: 1
    
    password:
      min-length: 8
      require-uppercase: true
      require-lowercase: true
      require-digit: true
      require-special-char: true
    
    brute-force:
      max-attempts: 5
      lockout-duration-minutes: 15
    
    headers:
      csp: "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'self'; frame-ancestors 'none'"
      hsts-max-age: 31536000
      hsts-include-subdomains: true
